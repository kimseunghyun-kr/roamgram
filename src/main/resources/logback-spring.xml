<configuration>


    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>
    <include resource="org/springframework/boot/logging/logback/console-appender.xml" />
    <root level="INFO">
        <appender-ref ref="CONSOLE" />
    </root>
    <logger name="org.springframework.web" level="DEBUG"/>

    <springProfile name="prod">
        <appender name="LOGSTASH" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
            <destination>172.17.0.1:5044</destination>
            <encoder class="net.logstash.logback.encoder.LogstashEncoder"/>
        </appender>
        <appender name="ROLLING_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
            <!-- Define the path to the log file -->
            <file>/var/log/spring-boot/roamgram.log</file>

            <!-- Define the rolling policy -->
            <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
                <!-- Roll the log file every day -->
                <fileNamePattern>/var/log/spring-boot/roamgram.%d{yyyy-MM-dd}.log</fileNamePattern>
                <!-- Keep 7 days worth of log files -->
                <maxHistory>3</maxHistory>
            </rollingPolicy>

            <!-- Define the triggering policy to roll based on file size -->
            <triggeringPolicy class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy">
                <maxFileSize>100MB</maxFileSize>
            </triggeringPolicy>

            <!-- Add a threshold filter to only log INFO and above -->
            <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
                <level>INFO</level>
            </filter>

            <!-- Use the JSON encoder with custom fields -->
            <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
                <providers>
                    <timestamp>
                        <fieldName>timestamp</fieldName>
                    </timestamp>
                    <pattern>
                        <pattern>
                            {
                            "level": "%level",
                            "logger": "%logger",
                            "thread": "%thread",
                            "message": "%message"
                            }
                        </pattern>
                    </pattern>
                </providers>
            </encoder>
        </appender>
    </springProfile>

    <root level="info">
        <appender-ref ref="CONSOLE"/>
        <springProfile name="prod">
            <appender-ref ref="ROLLING_FILE"/>
            <appender-ref ref="LOGSTASH"/>
        </springProfile>
    </root>

    <!-- Example of specific logger levels -->
    <logger name="org.springframework" level="INFO"/>
    <logger name="org.hibernate" level="ERROR"/>
</configuration>